---
# Common setup tasks for servers

- name: Ensure a locale exists
  community.general.locale_gen:
    name: "{{ item }}"
  with_items: "{{ common_setup_locales }}"

- name: Set timezone
  community.general.timezone:
    name: "{{ common_setup_timezone }}"

- name: Set hostname
  ansible.builtin.hostname:
    name: "{{ ansible_host }}"

- name: Import SSH keys for root
  ansible.posix.authorized_key:
    user: root
    key: https://github.com/{{ item }}.keys
    comment: "{{ item }}"
  ignore_errors: yes
  with_items: "{{ common_setup_github_users }}"

- name: Ensure /opt/containers/env_files directory exists
  ansible.builtin.file:
    path: "{{ common_setup_env_files_dir }}"
    state: directory
    mode: "0755"

- name: Copy email.env
  ansible.builtin.copy:
    src: "{{ common_setup_email_env_src }}"
    dest: "{{ common_setup_env_files_dir }}/email.env"
