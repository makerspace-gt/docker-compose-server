- name: Check valid cluster input
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Fail if no cluster is provided
      fail:
        msg: "You must pass a cluster variable (e.g. -e 'cluster=staging')"
      when: cluster is not defined

- name: Bootstrap Flux for {{ cluster }}
  hosts: all
  gather_facts: true
  become: true
  tasks:
    - name: Run flux bootstrap for {{ cluster }}
      shell: |
        flux bootstrap github \
          --owner=nielsfechtel \
          --repository=fork-mkspgt-docker-compose-server \
          --branch=feature/kubernetes \
          --path=clusters/{{ cluster }} \
          --personal
      when: cluster is defined
